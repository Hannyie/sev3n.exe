<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Rabbit Jump Game</title>
  <style>
    body {
      margin: 0;
      background: black;
      overflow: hidden;
    }
    canvas {
      display: block;
      margin: 0 auto;
      background: linear-gradient(to top, #000, #111);
    }
    #startButton, #gameOverText {
      position: absolute;
      left: 50%;
      transform: translateX(-50%);
      color: white;
      font-family: monospace;
      text-align: center;
    }
    #startButton {
      top: 40%;
      font-size: 24px;
      padding: 12px 24px;
      background: #444;
      border: 2px solid white;
      cursor: pointer;
    }
    #gameOverText {
      top: 45%;
      font-size: 30px;
      display: none;
      cursor: pointer;
    }
    #countdown {
      position: absolute;
      top: 40%;
      left: 50%;
      transform: translate(-50%, -50%);
      color: white;
      font-family: monospace;
      font-size: 50px;
      display: none;
    }
  </style>
</head>
<body>
  <canvas id="gameCanvas" width="400" height="600"></canvas>
  <div id="startButton">Start Game</div>
  <div id="countdown">3</div>
  <div id="gameOverText">Game Over<br><small>Click to Restart</small></div>

  <script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');

    const startButton = document.getElementById('startButton');
    const gameOverText = document.getElementById('gameOverText');
    const countdownDiv = document.getElementById('countdown');

    const gravity = 0.5;
    const jumpStrength = -10;

    const rabbitImg = new Image();
    rabbitImg.src = 'rabbit.png'; // dùng hình bạn đã upload

    let rabbit, platforms, score, isGameRunning = false;

    function initGame() {
      rabbit = {
        x: 150,
        y: 100,
        width: 60,
        height: 60,
        velocityY: 0
      };

      platforms = [];
      score = 0;

      for (let i = 0; i < 5; i++) {
        createPlatform(Math.random() * 300, i * 120 + 100);
      }
    }

    function createPlatform(x, y, width = 100, height = 10) {
      platforms.push({ x, y, width, height });
    }

    function update() {
      rabbit.velocityY += gravity;
      rabbit.y += rabbit.velocityY;

      if (rabbit.y > canvas.height) {
        endGame();
        return;
      }

      for (let plat of platforms) {
        plat.x -= 2;

        if (
          rabbit.x + rabbit.width > plat.x &&
          rabbit.x < plat.x + plat.width &&
          rabbit.y + rabbit.height > plat.y &&
          rabbit.y + rabbit.height < plat.y + 10 &&
          rabbit.velocityY > 0
        ) {
          rabbit.y = plat.y - rabbit.height;
          rabbit.velocityY = jumpStrength;
          score++;
        }
      }

      if (platforms.length > 0 && platforms[0].x + platforms[0].width < 0) {
        platforms.shift();
        createPlatform(canvas.width, Math.random() * (canvas.height - 200) + 100);
      }
    }

    function draw() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      ctx.fillStyle = "#0ff";
      for (let plat of platforms) {
        ctx.fillRect(plat.x, plat.y, plat.width, plat.height);
      }

      ctx.drawImage(rabbitImg, rabbit.x, rabbit.y, rabbit.width, rabbit.height);

      ctx.fillStyle = "#fff";
      ctx.font = "20px monospace";
      ctx.fillText("Score: " + score, 10, 30);
    }

    function gameLoop() {
      if (isGameRunning) {
        update();
        draw();
        requestAnimationFrame(gameLoop);
      }
    }

    function startCountdown() {
      let count = 3;
      countdownDiv.style.display = 'block';
      countdownDiv.textContent = count;

      const countdownInterval = setInterval(() => {
        count--;
        if (count > 0) {
          countdownDiv.textContent = count;
        } else {
          clearInterval(countdownInterval);
          countdownDiv.style.display = 'none';
          isGameRunning = true;
          gameLoop();
        }
      }, 1000);
    }

    function endGame() {
      isGameRunning = false;
      gameOverText.style.display = 'block';
    }

    // Start game on button click
    startButton.addEventListener('click', () => {
      startButton.style.display = 'none';
      initGame();
      startCountdown();
    });

    // Restart game from Game Over screen
    gameOverText.addEventListener('click', () => {
      gameOverText.style.display = 'none';
      initGame();
      startCountdown();
    });

    // Jump on space
    document.addEventListener('keydown', (e) => {
      if (e.code === 'Space' && isGameRunning && rabbit.velocityY > -5) {
        rabbit.velocityY = jumpStrength;
      }
    });

    rabbitImg.onload = () => {
      draw(); // Vẽ khung đầu tiên khi chưa chạy game
    };
  </script>
</body>
</html>
